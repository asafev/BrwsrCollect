<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDP Detector Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-area {
            border: 2px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            min-height: 200px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
        .metrics {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .likelihood {
            font-size: 24px;
            font-weight: bold;
            padding: 20px;
            text-align: center;
            border-radius: 5px;
            margin: 20px 0;
        }
        .low { background: #c8e6c9; color: #2e7d32; }
        .medium { background: #ffe0b2; color: #e65100; }
        .high { background: #ffcdd2; color: #c62828; }
    </style>
</head>
<body>
    <h1>üîç CDP Detector Test</h1>
    <p>This is a standalone test for the CDP signals detector. Interact with the page naturally, then click "Get Metrics" to see your automation likelihood score.</p>

    <div class="test-area">
        <h3>Test Area</h3>
        <p>Click these buttons, scroll, type in the input, move your mouse around...</p>
        <button id="btn1">Button 1</button>
        <button id="btn2">Button 2</button>
        <button id="btn3">Button 3</button>
        <br><br>
        <input type="text" id="test-input" placeholder="Type something...">
        <br><br>
        <textarea rows="4" cols="50" placeholder="More typing here..."></textarea>
    </div>

    <button id="get-metrics" style="background: #2196F3; color: white; font-size: 16px;">Get Metrics</button>
    <button id="reset" style="background: #f44336; color: white;">Reset</button>

    <div id="likelihood-display"></div>
    <div id="metrics-display"></div>

    <script type="module">
        import { initCdpSignals } from './detectors/cdpSignals.js';

        // Initialize detector
        const report = { metrics: {} };
        const cdpDetector = initCdpSignals({ report, bus: null });

        console.log('‚úÖ CDP Detector initialized');

        // Get metrics button
        document.getElementById('get-metrics').addEventListener('click', () => {
            const metrics = cdpDetector.snapshot();
            displayMetrics(metrics);
        });

        // Reset button
        document.getElementById('reset').addEventListener('click', () => {
            location.reload();
        });

        function displayMetrics(metrics) {
            const likelihood = metrics.cdpLikelihood;
            
            // Display likelihood
            const likelihoodDiv = document.getElementById('likelihood-display');
            let className = 'low';
            let label = 'LOW RISK - Likely Human';
            
            if (likelihood >= 70) {
                className = 'high';
                label = 'HIGH RISK - Likely Automation';
            } else if (likelihood >= 40) {
                className = 'medium';
                label = 'MEDIUM RISK - Suspicious';
            }
            
            likelihoodDiv.innerHTML = `
                <div class="likelihood ${className}">
                    CDP Likelihood: ${likelihood.toFixed(1)}%<br>
                    <small>${label}</small>
                </div>
            `;

            // Display detailed metrics
            const metricsDiv = document.getElementById('metrics-display');
            metricsDiv.innerHTML = `
                <h3>Detailed Metrics</h3>
                <div class="metrics">${JSON.stringify(metrics, null, 2)}</div>
            `;
        }

        // Add some test click handlers
        document.getElementById('btn1').addEventListener('click', () => {
            console.log('Button 1 clicked');
        });
        document.getElementById('btn2').addEventListener('click', () => {
            console.log('Button 2 clicked');
        });
        document.getElementById('btn3').addEventListener('click', () => {
            console.log('Button 3 clicked');
        });
    </script>
</body>
</html>
