<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser Fingerprint Analysis</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Fingerprint Page Specific Styles */
        .fingerprint-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem;
            background: #f8f9fa;
            min-height: 100vh;
        }

        .fingerprint-header {
            text-align: center;
            margin-bottom: 1.5rem;
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.2);
        }

        .fingerprint-header h1 {
            margin: 0 0 0.25rem 0;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .fingerprint-header p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.85;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .summary-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            text-align: center;
            border: 1px solid #e9ecef;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .summary-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }

        .summary-card h3 {
            margin: 0 0 0.4rem 0;
            color: #2c3e50;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-card .value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.3rem;
        }

        .summary-card .description {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .risk-low { color: #28a745; }
        .risk-medium { color: #ffc107; }
        .risk-high { color: #dc3545; }

        /* Suspicious Indicators Styles */
        .suspicious-indicators-section {
            margin: 1.5rem 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #e9ecef;
        }

        .suspicious-indicators-header {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 1rem 1.5rem;
            text-align: center;
        }

        .suspicious-indicators-header.no-indicators {
            background: linear-gradient(135deg, #28a745 0%, #20a038 100%);
        }

        .suspicious-indicators-header h3 {
            margin: 0 0 0.3rem 0;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .suspicious-indicators-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 0.85rem;
        }

        .indicators-summary {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 0.75rem;
        }

        .summary-stat {
            text-align: center;
        }

        .summary-stat .number {
            font-size: 1.25rem;
            font-weight: 700;
            display: block;
        }

        .summary-stat .label {
            font-size: 0.8rem;
            opacity: 0.85;
        }

        .indicators-list {
            padding: 1rem;
        }

        .indicator-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid #dc3545;
        }

        .indicator-item.risk-medium {
            border-left-color: #ffc107;
        }

        .indicator-item.risk-low {
            border-left-color: #28a745;
        }

        .indicator-icon {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            background: #dc3545;
            color: white;
        }

        .indicator-icon.risk-medium {
            background: #ffc107;
        }

        .indicator-icon.risk-low {
            background: #28a745;
        }

        .indicator-content {
            flex: 1;
        }

        .indicator-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: #2c3e50;
            font-family: 'Courier New', monospace;
        }

        .indicator-description {
            color: #495057;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .indicator-details {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            align-items: center;
        }

        .indicator-value {
            background: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            color: #495057;
            border: 1px solid #dee2e6;
        }

        .indicator-confidence {
            background: #e9ecef;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            color: #495057;
        }

        .indicator-category {
            background: #007bff;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .no-indicators-message {
            text-align: center;
            padding: 2rem;
            color: #6c757d;
        }

        .no-indicators-message .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        /* Behavioral Indicators Styles */
        .behavioral-indicators-section {
            margin: 1.5rem 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #e9ecef;
        }

        .behavioral-indicators-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 1.5rem;
            text-align: center;
        }

        .behavioral-indicators-header.no-indicators {
            background: linear-gradient(135deg, #28a745 0%, #20a038 100%);
        }

        .behavioral-indicators-header h3 {
            margin: 0 0 0.3rem 0;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .behavioral-indicators-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 0.85rem;
        }

        .behavioral-list {
            padding: 1rem;
        }

        .behavioral-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid #667eea;
        }

        .behavioral-item.detected {
            border-left-color: #dc3545;
            background: #fff5f5;
        }

        .behavioral-icon {
            font-size: 1.2rem;
            margin-top: 0.2rem;
        }

        .behavioral-content {
            flex: 1;
        }

        .behavioral-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: #2c3e50;
        }

        .behavioral-description {
            color: #495057;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .behavioral-details {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
            color: #6c757d;
        }

        .behavioral-detail {
            background: #e9ecef;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }

        .behavioral-confidence {
            background: #d4edda;
            color: #155724;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 600;
        }

        .behavioral-confidence.high {
            background: #f8d7da;
            color: #721c24;
        }

        /* Metrics Table Styles */
        .metrics-table-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #e9ecef;
            margin-top: 1.5rem;
        }

        .metrics-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .metrics-table th {
            background: linear-gradient(135deg, #6f42c1, #8b5cf6);
            color: white;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            font-size: 0.85rem;
        }

        .metrics-table th:first-child { width: 60px; }
        .metrics-table th:nth-child(2) { width: 200px; }
        .metrics-table th:nth-child(3) { width: 150px; }
        .metrics-table th:nth-child(4) { width: 250px; }
        .metrics-table th:nth-child(5) { width: 300px; }
        .metrics-table th:nth-child(6) { width: 80px; }

        .section-header {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-left: 4px solid;
            font-weight: 700;
            color: #2c3e50;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.85rem;
        }

        .section-header td {
            padding: 0.75rem !important;
            text-align: center;
            border-bottom: 2px solid #dee2e6 !important;
        }

        /* Section-specific colors */
        .section-navigator { border-left-color: #007bff; }
        .section-display { border-left-color: #28a745; }
        .section-window { border-left-color: #17a2b8; }
        .section-automation { border-left-color: #dc3545; }
        .section-jsEnvironment { border-left-color: #ffc107; }
        .section-graphics { border-left-color: #6f42c1; }
        .section-performance { border-left-color: #fd7e14; }
        .section-webApis { border-left-color: #20c997; }
        .section-document { border-left-color: #6c757d; }
        .section-security { border-left-color: #e83e8c; }
        .section-aiAgentDetection { border-left-color: #ff6b6b; }

        .metrics-table td {
            padding: 0.6rem 0.75rem;
            border-bottom: 1px solid #f1f3f4;
            vertical-align: top;
        }

        .metrics-table tr:hover {
            background-color: #f8f9fa;
        }

        .metric-number {
            font-weight: 700;
            color: #6f42c1;
            text-align: center;
            font-family: 'Monaco', 'Consolas', monospace;
        }

        .metric-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .metric-value {
            font-family: 'Monaco', 'Consolas', monospace;
            background: #f8f9fa;
            padding: 0.3rem 0.5rem;
            border-radius: 4px;
            border: 1px solid #e9ecef;
            font-size: 0.8rem;
            color: #495057;
            word-break: break-all;
            max-width: 140px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .metric-description {
            color: #6c757d;
            font-size: 0.8rem;
            line-height: 1.3;
        }

        .metric-code {
            font-family: 'Monaco', 'Consolas', monospace;
            background: #f1f3f4;
            padding: 0.3rem 0.5rem;
            border-radius: 4px;
            border: 1px solid #dee2e6;
            font-size: 0.75rem;
            color: #495057;
            word-break: break-all;
            line-height: 1.2;
        }

        .risk-badge {
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-align: center;
        }

        .risk-badge.low {
            background: #d4edda;
            color: #155724;
        }

        .risk-badge.medium {
            background: #fff3cd;
            color: #856404;
        }

        .risk-badge.high {
            background: #f8d7da;
            color: #721c24;
        }

        .risk-badge.none {
            background: #e2e3e5;
            color: #6c757d;
        }

        /* Responsive table */
        @media (max-width: 1200px) {
            .metrics-table-container {
                overflow-x: auto;
            }
            
            .metrics-table {
                min-width: 1000px;
            }
        }

        .metrics-grid {
            display: none; /* Hide the old grid layout */
        }

        .loading-state {
            text-align: center;
            padding: 3rem;
            color: #6c757d;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #6f42c1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .back-button {
            position: fixed;
            top: 1.5rem;
            left: 1.5rem;
            padding: 0.75rem 1.25rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.25);
            transition: all 0.2s ease;
            z-index: 1000;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.35);
        }

        .export-controls {
            text-align: center;
            margin: 1.5rem 0 1rem 0;
        }

        .export-btn {
            padding: 0.75rem 1.5rem;
            margin: 0 0.5rem;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .fingerprint-container {
                padding: 1rem;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .back-button {
                position: static;
                width: 100%;
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <button class="back-button" onclick="window.history.back()">
        ‚Üê Back to Lab
    </button>

    <div class="fingerprint-container">
        <div class="fingerprint-header">
            <h1>üîç Browser Fingerprint Analysis</h1>
            <p>Comprehensive browser characteristics and automation detection metrics</p>
        </div>

        <div id="loading-state" class="loading-state">
            <div class="loading-spinner"></div>
            <h3>Analyzing Browser Fingerprint...</h3>
            <p>Collecting and processing browser characteristics</p>
        </div>

        <div id="fingerprint-content" style="display: none;">
            <!-- Summary Cards -->
            <div class="summary-cards">
                <div class="summary-card">
                    <h3>Total Metrics</h3>
                    <div class="value" id="total-metrics">0</div>
                    <div class="description">Browser characteristics analyzed</div>
                </div>
                <div class="summary-card">
                    <h3>Risk Level</h3>
                    <div class="value" id="risk-level">-</div>
                    <div class="description">Overall automation risk assessment</div>
                </div>
                <div class="summary-card">
                    <h3>High Risk Indicators</h3>
                    <div class="value risk-high" id="high-risk-count">0</div>
                    <div class="description">Critical automation indicators</div>
                </div>
                <div class="summary-card">
                    <h3>Automation Likelihood</h3>
                    <div class="value" id="automation-likelihood">-</div>
                    <div class="description">Probability of automated browsing</div>
                </div>
            </div>

            <!-- Suspicious Indicators Section -->
            <div class="suspicious-indicators-section" id="suspicious-indicators-section">
                <div class="suspicious-indicators-header" id="suspicious-header">
                    <h3 id="suspicious-title">üö® Suspicious Browser Patterns Detected</h3>
                    <p id="suspicious-subtitle">Patterns that may indicate sandbox environments or automation tools</p>
                    <div class="indicators-summary" id="indicators-summary">
                        <div class="summary-stat">
                            <span class="number" id="total-suspicious">0</span>
                            <span class="label">Total Indicators</span>
                        </div>
                        <div class="summary-stat">
                            <span class="number" id="high-risk-suspicious">0</span>
                            <span class="label">High Risk</span>
                        </div>
                        <div class="summary-stat">
                            <span class="number" id="suspicion-score">0%</span>
                            <span class="label">Suspicion Score</span>
                        </div>
                    </div>
                </div>
                <div class="indicators-list" id="indicators-list">
                    <!-- Indicators will be populated here -->
                </div>
            </div>

            <!-- Behavioral Indicators Section -->
            <div class="behavioral-indicators-section" id="behavioral-indicators-section">
                <div class="behavioral-indicators-header" id="behavioral-header">
                    <h3 id="behavioral-title">üéØ Behavioral Analysis</h3>
                    <p id="behavioral-subtitle">Analysis of user interaction patterns and behavioral indicators</p>
                    <div class="indicators-summary" id="behavioral-summary">
                        <div class="summary-stat">
                            <span class="number" id="behavioral-detected">0</span>
                            <span class="label">Detected Patterns</span>
                        </div>
                        <div class="summary-stat">
                            <span class="number" id="behavioral-confidence">0%</span>
                            <span class="label">Max Confidence</span>
                        </div>
                        <div class="summary-stat">
                            <span class="number" id="behavioral-risk">None</span>
                            <span class="label">Risk Level</span>
                        </div>
                    </div>
                </div>
                <div class="behavioral-list" id="behavioral-list">
                    <!-- Behavioral indicators will be populated here -->
                </div>
            </div>

            <!-- Export Controls -->
            <div class="export-controls">
                <button class="export-btn" onclick="exportFingerprintData('json')">
                    üìÑ Export JSON
                </button>
                <button class="export-btn" onclick="exportFingerprintData('csv')">
                    üìä Export CSV
                </button>
            </div>

            <!-- Metrics Table -->
            <div class="metrics-table-container">
                <table class="metrics-table" id="metrics-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Metric Name</th>
                            <th>Value</th>
                            <th>Description</th>
                            <th>JavaScript Code</th>
                            <th>Risk</th>
                        </tr>
                    </thead>
                    <tbody id="metrics-table-body">
                        <!-- Metrics will be populated here -->
                    </tbody>
                </table>
            </div>

            <!-- Metrics Grid (Hidden) -->
            <div class="metrics-grid" id="metrics-grid" style="display: none;">
                <!-- Old grid layout hidden -->
            </div>
        </div>
    </div>

    <script type="module">
        import { BrowserFingerprintAnalyzer } from './browserFingerprint.js';
        import { BehavioralStorageManager } from './behavioralStorage.js';

        let fingerprintData = null;

        // Initialize fingerprint analysis
        async function initializeAnalysis() {
            try {
                const analyzer = new BrowserFingerprintAnalyzer();
                await analyzer.analyzeFingerprint();
                fingerprintData = analyzer.getAnalysisResults();
                
                // Hide loading state and show content
                document.getElementById('loading-state').style.display = 'none';
                document.getElementById('fingerprint-content').style.display = 'block';
                
                // Populate the UI
                populateSummary(fingerprintData.summary);
                populateSuspiciousIndicators(fingerprintData.suspiciousIndicators, fingerprintData.suspiciousSummary);
                populateBehavioralIndicators(fingerprintData.metrics.behavioralIndicators);
                populateMetrics(fingerprintData.metrics);
                
            } catch (error) {
                console.error('Error during fingerprint analysis:', error);
                document.getElementById('loading-state').innerHTML = `
                    <h3>Analysis Failed</h3>
                    <p>Error: ${error.message}</p>
                `;
            }
        }

        // Populate summary cards
        function populateSummary(summary) {
            document.getElementById('total-metrics').textContent = summary.totalMetrics;
            document.getElementById('high-risk-count').textContent = summary.highRiskIndicators;
            document.getElementById('automation-likelihood').textContent = summary.automationLikelihood;
            
            const riskElement = document.getElementById('risk-level');
            riskElement.textContent = summary.riskLevel;
            riskElement.className = `value risk-${summary.riskLevel.toLowerCase()}`;
        }

        // Populate suspicious indicators section
        function populateSuspiciousIndicators(indicators, summary) {
            const section = document.getElementById('suspicious-indicators-section');
            const header = document.getElementById('suspicious-header');
            const title = document.getElementById('suspicious-title');
            const subtitle = document.getElementById('suspicious-subtitle');
            const indicatorsList = document.getElementById('indicators-list');
            
            // Update summary stats
            document.getElementById('total-suspicious').textContent = summary.totalIndicators;
            document.getElementById('high-risk-suspicious').textContent = summary.riskCounts.HIGH;
            document.getElementById('suspicion-score').textContent = `${Math.round(summary.suspicionScore * 100)}%`;
            
            if (!summary.hasSuspiciousActivity) {
                // Hide the entire section when no suspicious indicators
                section.style.display = 'none';
            } else {
                // Show section when suspicious indicators found
                section.style.display = 'block';
                
                // Suspicious indicators found and above threshold
                header.className = 'suspicious-indicators-header';
                title.innerHTML = 'üö® Suspicious Browser Patterns Detected';
                subtitle.textContent = 'Patterns that indicate sandbox environments or automation tools';
                
                // Clear and populate indicators list
                indicatorsList.innerHTML = '';
                
                // Add reasoning header if available
                if (summary.reasoning) {
                    const reasoningDiv = document.createElement('div');
                    reasoningDiv.style.cssText = 'background: #fff3cd; border: 1px solid #ffeaa7; padding: 0.75rem; margin-bottom: 0.75rem; border-radius: 6px;';
                    reasoningDiv.innerHTML = `
                        <strong>Detection Reasoning:</strong> ${summary.reasoning}
                        ${summary.totalDetectedIndicators > summary.totalIndicators ? 
                            `<br><small>Additional ${summary.totalDetectedIndicators - summary.totalIndicators} weak indicator(s) also detected.</small>` : ''
                        }
                    `;
                    indicatorsList.appendChild(reasoningDiv);
                }
                
                indicators.forEach(indicator => {
                    const indicatorDiv = document.createElement('div');
                    indicatorDiv.className = `indicator-item risk-${indicator.riskLevel.toLowerCase()}`;
                    
                    const icon = getRiskIcon(indicator.riskLevel);
                    const importanceIcon = getImportanceIcon(indicator.importance);
                    
                    indicatorDiv.innerHTML = `
                        <div class="indicator-icon risk-${indicator.riskLevel.toLowerCase()}">
                            ${icon}
                        </div>
                        <div class="indicator-content">
                            <div class="indicator-name">
                                ${indicator.name} ${importanceIcon}
                            </div>
                            <div class="indicator-description">${indicator.description}</div>
                            <div class="indicator-details">
                                <span class="indicator-category">${indicator.category}</span>
                                <span class="indicator-value">Value: ${indicator.value}</span>
                                <span class="indicator-confidence">Confidence: ${Math.round(indicator.confidence * 100)}%</span>
                                <span class="indicator-importance" style="background: ${getImportanceColor(indicator.importance)}; color: white;">
                                    ${indicator.importance}
                                </span>
                            </div>
                            ${indicator.details ? `<div style="margin-top: 0.5rem; font-size: 0.8rem; color: #6c757d;">${indicator.details}</div>` : ''}
                        </div>
                    `;
                    
                    indicatorsList.appendChild(indicatorDiv);
                });
            }
        }

        // Get risk level icon
        function getRiskIcon(riskLevel) {
            switch (riskLevel) {
                case 'HIGH': return 'üö®';
                case 'MEDIUM': return '‚ö†Ô∏è';
                case 'LOW': return 'üí°';
                default: return '‚ùì';
            }
        }

        // Get importance level icon
        function getImportanceIcon(importance) {
            switch (importance) {
                case 'CRITICAL': return 'üî¥';
                case 'STRONG': return 'üü°';
                case 'WEAK': return 'üîµ';
                default: return '‚ö™';
            }
        }

        // Get importance level color
        function getImportanceColor(importance) {
            switch (importance) {
                case 'CRITICAL': return '#dc3545';
                case 'STRONG': return '#ffc107';
                case 'WEAK': return '#6c757d';
                default: return '#e9ecef';
            }
        }

        // Populate behavioral indicators section
        function populateBehavioralIndicators(behavioralData) {
            const section = document.getElementById('behavioral-indicators-section');
            const header = document.getElementById('behavioral-header');
            const title = document.getElementById('behavioral-title');
            const subtitle = document.getElementById('behavioral-subtitle');
            const behavioralList = document.getElementById('behavioral-list');
            
            if (!behavioralData || behavioralData.error) {
                // Hide section if no behavioral data available
                section.style.display = 'none';
                return;
            }
            
            // Extract summary data
            const detected = Object.keys(behavioralData).filter(key => 
                behavioralData[key] && behavioralData[key].value === true
            ).length;
            
            const maxConfidence = behavioralData.maxConfidence?.value || 0;
            const riskLevel = behavioralData.riskLevel?.value || 'None';
            
            // Update summary stats
            document.getElementById('behavioral-detected').textContent = detected;
            document.getElementById('behavioral-confidence').textContent = `${Math.round(maxConfidence * 100)}%`;
            document.getElementById('behavioral-risk').textContent = riskLevel;
            
            // Hide section if no behavioral anomalies detected
            if (detected === 0) {
                section.style.display = 'none';
                return;
            }
            
            // Show section since we have detections
            section.style.display = 'block';
            
            // Style header based on risk level
            if (riskLevel === 'HIGH' || riskLevel === 'MEDIUM') {
                header.className = 'behavioral-indicators-header';
                title.innerHTML = 'üö® Behavioral Anomalies Detected';
                subtitle.textContent = 'Suspicious interaction patterns detected during testing';
            } else if (detected > 0) {
                header.className = 'behavioral-indicators-header';
                title.innerHTML = '‚ö†Ô∏è Behavioral Patterns Detected';
                subtitle.textContent = 'Some automated behavior patterns identified';
            }
            
            // Clear and populate behavioral list
            behavioralList.innerHTML = '';
            
            // Add session info if available
            if (behavioralData.sessionDuration && behavioralData.sessionDuration.value > 0) {
                const sessionInfo = document.createElement('div');
                sessionInfo.className = 'behavioral-session-info';
                sessionInfo.style.cssText = `
                    background: #e7f3ff;
                    padding: 0.75rem;
                    border-radius: 6px;
                    margin-bottom: 0.75rem;
                    border-left: 3px solid #0066cc;
                `;
                sessionInfo.innerHTML = `
                    <h4 style="margin: 0 0 0.35rem 0; color: #0066cc; font-size: 0.95rem;">üìä Session Information</h4>
                    <p style="margin: 0; color: #495057; font-size: 0.85rem;">
                        Session Duration: ${behavioralData.sessionDuration.value}s | 
                        Total Events: ${behavioralData.totalEvents?.value || 0} | 
                        Analysis Summary: ${behavioralData.summary?.value || 'No summary available'}
                    </p>
                `;
                behavioralList.appendChild(sessionInfo);
            }
            
            // Add individual behavioral indicators - ONLY SHOW DETECTED ONES
            const indicatorKeys = [
                'centralButtonClicks',
                'clicksWithoutMouseMovement', 
                'nonHumanScrolling',
                'artificialTiming',
                'missingMouseTrails'
            ];
            
            indicatorKeys.forEach(key => {
                const indicator = behavioralData[key];
                if (!indicator) return;
                
                // ONLY SHOW IF DETECTED (value === true)
                if (!indicator.value) return;
                
                const item = document.createElement('div');
                item.className = `behavioral-item detected`;
                
                const icon = 'üö®';
                const confidenceClass = indicator.confidence > 0.7 ? 'high' : '';
                
                item.innerHTML = `
                    <div class="behavioral-icon">${icon}</div>
                    <div class="behavioral-content">
                        <div class="behavioral-name">${formatBehavioralName(key)}</div>
                        <div class="behavioral-description">${indicator.description}</div>
                        <div class="behavioral-details">
                            <span class="behavioral-detail">Count: ${indicator.count}</span>
                            <span class="behavioral-detail">Threshold: ${indicator.threshold}</span>
                            <span class="behavioral-confidence ${confidenceClass}">
                                Confidence: ${Math.round(indicator.confidence * 100)}%
                            </span>
                            <span class="behavioral-detail" style="background: #f8d7da; color: #721c24; font-weight: 600;">DETECTED</span>
                        </div>
                        ${indicator.details && indicator.details.length > 0 ? `
                            <details style="margin-top: 0.5rem;">
                                <summary style="cursor: pointer; color: #667eea; font-size: 0.85rem;">Recent Examples (${indicator.details.length})</summary>
                                <div style="margin-top: 0.5rem; font-size: 0.75rem;">
                                    ${indicator.details.slice(0, 3).map(detail => `
                                        <div style="background: #f8f9fa; padding: 0.25rem 0.5rem; margin: 0.25rem 0; border-radius: 4px;">
                                            ${JSON.stringify(detail, null, 2).substring(0, 150)}...
                                        </div>
                                    `).join('')}
                                </div>
                            </details>
                        ` : ''}
                    </div>
                `;
                
                behavioralList.appendChild(item);
            });
        }
        
        // Helper function to format behavioral indicator names
        function formatBehavioralName(key) {
            const names = {
                'centralButtonClicks': 'Central Button Clicks',
                'clicksWithoutMouseMovement': 'Clicks Without Mouse Movement',
                'nonHumanScrolling': 'Non-Human Scrolling',
                'artificialTiming': 'Artificial Timing Patterns',
                'missingMouseTrails': 'Missing Mouse Trails'
            };
            return names[key] || key;
        }

        function populateMetrics(metrics) {
            const tableBody = document.getElementById('metrics-table-body');
            tableBody.innerHTML = '';
            let metricNumber = 1;

            for (const [categoryName, categoryMetrics] of Object.entries(metrics)) {
                // Add section header row
                const sectionRow = createSectionHeaderRow(categoryName);
                tableBody.appendChild(sectionRow);

                // Add metric rows for this section
                for (const [metricName, metricData] of Object.entries(categoryMetrics)) {
                    const metricRow = createMetricRow(metricNumber++, metricName, metricData, categoryName);
                    tableBody.appendChild(metricRow);
                }
            }
        }

        // Create section header row
        function createSectionHeaderRow(categoryName) {
            const row = document.createElement('tr');
            row.className = `section-header section-${categoryName}`;
            
            const cell = document.createElement('td');
            cell.colSpan = 6;
            cell.innerHTML = `${getCategoryIcon(categoryName)} ${formatCategoryName(categoryName)}`;
            
            row.appendChild(cell);
            return row;
        }

        // Create individual metric row
        function createMetricRow(number, name, data, category) {
            const row = document.createElement('tr');

            // Number
            const numberCell = document.createElement('td');
            numberCell.className = 'metric-number';
            numberCell.textContent = number;

            // Name
            const nameCell = document.createElement('td');
            nameCell.className = 'metric-name';
            nameCell.textContent = formatMetricName(name);

            // Value
            const valueCell = document.createElement('td');
            const valueDiv = document.createElement('div');
            valueDiv.className = 'metric-value';
            valueDiv.textContent = formatValue(data.value);
            valueDiv.title = String(data.value); // Full value on hover
            valueCell.appendChild(valueDiv);

            // Description
            const descCell = document.createElement('td');
            descCell.className = 'metric-description';
            descCell.textContent = data.description;

            // JavaScript Code
            const codeCell = document.createElement('td');
            const codeDiv = document.createElement('div');
            codeDiv.className = 'metric-code';
            codeDiv.textContent = getJavaScriptCode(name, category);
            codeCell.appendChild(codeDiv);

            // Risk
            const riskCell = document.createElement('td');
            const riskBadge = document.createElement('div');
            riskBadge.className = `risk-badge ${(data.risk || 'none').toLowerCase()}`;
            riskBadge.textContent = data.risk || 'N/A';
            riskCell.appendChild(riskBadge);

            row.appendChild(numberCell);
            row.appendChild(nameCell);
            row.appendChild(valueCell);
            row.appendChild(descCell);
            row.appendChild(codeCell);
            row.appendChild(riskCell);

            return row;
        }

        // Get category icon
        function getCategoryIcon(categoryName) {
            const icons = {
                navigator: 'üß≠',
                display: 'üñ•Ô∏è',
                window: 'ü™ü',
                automation: 'ü§ñ',
                jsEnvironment: '‚öôÔ∏è',
                graphics: 'üé®',
                performance: '‚ö°',
                webApis: 'üîå',
                document: 'üìÑ',
                security: 'üîí',
                apiOverrides: 'üîç',
                aiAgentDetection: 'üïµÔ∏è',
                stringSignatureAutomation: 'üî¨',
                behavioralIndicators: 'üéØ'
            };
            return icons[categoryName] || 'üìä';
        }

        // Get JavaScript code for each metric
        function getJavaScriptCode(metricName, category) {
            const codeMap = {
                // Navigator
                'userAgent': 'window.navigator.userAgent',
                'appCodeName': 'window.navigator.appCodeName',
                'cookieEnabled': 'window.navigator.cookieEnabled',
                'platform': 'window.navigator.platform',
                'language': 'window.navigator.language',
                'webdriver': 'window.navigator.webdriver',
                'maxTouchPoints': 'window.navigator.maxTouchPoints',
                'onLine': 'window.navigator.onLine',
                'buildID': 'window.navigator.buildID',
                'hardwareConcurrency': 'window.navigator.hardwareConcurrency',
                'mimeTypesLength': 'window.navigator.mimeTypes.length',
                'pluginsLength': 'window.navigator.plugins.length',
                'product': 'window.navigator.product',
                'appVersion': 'window.navigator.appVersion',
                'vendor': 'window.navigator.vendor',
                'vendorSub': 'window.navigator.vendorSub',
                'productSub': 'window.navigator.productSub',
                'doNotTrack': 'window.navigator.doNotTrack',
                'msDoNotTrack': 'window.navigator.msDoNotTrack',

                // Display
                'colorDepth': 'window.screen.colorDepth',
                'width': 'window.screen.width',
                'height': 'window.screen.height',
                'availWidth': 'window.screen.availWidth',
                'availHeight': 'window.screen.availHeight',
                'pixelDepth': 'window.screen.pixelDepth',
                'orientation': 'window.screen.orientation.type',

                // Window
                'innerWidth': 'window.innerWidth',
                'innerHeight': 'window.innerHeight',
                'outerWidth': 'window.outerWidth',
                'outerHeight': 'window.outerHeight',
                'screenTop': 'window.screenTop',
                'screenLeft': 'window.screenLeft',
                'scrollX': 'typeof window.scrollX !== "undefined"',
                'scrollY': 'typeof window.scrollY !== "undefined"',
                'devicePixelRatio': 'window.devicePixelRatio',
                'closed': 'window.closed',
                'opener': 'window.opener !== null',
                'self': 'typeof window.self !== "undefined"',

                // Automation
                'webdriverFlag': 'window.navigator.webdriver',
                'seleniumIndicators': 'window.seleniumKey !== undefined',
                'phantomjsCheck': 'window.callPhantom !== undefined || window._phantom !== undefined',
                'automationArtifacts': 'Multiple automation artifact checks',

                // JavaScript Environment
                'setTimeout': 'typeof window.setTimeout !== "undefined"',
                'setInterval': 'typeof window.setInterval !== "undefined"',
                'functionBind': 'typeof Function.prototype.bind !== "undefined"',
                'functionToString': 'typeof Function.prototype.toString !== "undefined"',
                'mathAbs': 'Math.abs(-3.186)',
                'arrayBuffer': 'typeof window.ArrayBuffer !== "undefined"',
                'int8Array': 'typeof window.Int8Array !== "undefined"',
                'int16Array': 'typeof window.Int16Array !== "undefined"',
                'int32Array': 'typeof window.Int32Array !== "undefined"',
                'promise': 'typeof window.Promise !== "undefined"',
                'boolean': 'typeof window.Boolean !== "undefined"',
                'map': 'typeof window.Map !== "undefined"',
                'uriError': 'typeof window.URIError !== "undefined"',

                // Graphics
                'webglRenderer': 'gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL)',
                'canvas': 'typeof document.createElement("canvas").getContext !== "undefined"',
                'webgl': 'canvas.getContext("webgl") || canvas.getContext("experimental-webgl")',

                // Performance
                'memoryLimit': 'window.performance.memory.jsHeapSizeLimit',
                'usedMemory': 'window.performance.memory.usedJSHeapSize',
                'totalMemory': 'window.performance.memory.totalJSHeapSize',
                'redirectCount': 'window.performance.navigation.redirectCount',
                'navigationType': 'window.performance.navigation.type',
                'timezoneOffset': 'new Date().getTimezoneOffset()',

                // Web APIs
                'geolocation': '!!window.navigator.geolocation',
                'getUserMedia': '!!window.navigator.getUserMedia',
                'sendBeacon': '!!window.navigator.sendBeacon',
                'localStorage': 'typeof window.localStorage !== "undefined"',
                'sessionStorage': 'typeof window.sessionStorage !== "undefined"',
                'indexedDB': 'typeof window.indexedDB !== "undefined"',
                'webDatabase': 'typeof window.openDatabase !== "undefined"',
                'webkitSpeechGrammar': 'typeof window.webkitSpeechGrammar !== "undefined"',
                'cacheStorage': 'typeof window.CacheStorage !== "undefined"',
                'midiPort': 'typeof window.MIDIPort !== "undefined"',
                'mimeTypeArray': 'typeof window.MimeTypeArray !== "undefined"',
                'pluginArray': 'typeof window.PluginArray !== "undefined"',

                // Document
                'hasFocus': 'document.hasFocus()',
                'webkitHidden': 'document.webkitHidden',
                'documentMode': 'document.documentMode',
                'elementFromPoint': 'document.elementFromPoint(0,0).childNodes.length',
                'textNode': 'document.TEXT_NODE',
                'commentNode': 'document.COMMENT_NODE',
                'attributeNode': 'document.ATTRIBUTE_NODE',
                'processingInstructionNode': 'document.PROCESSING_INSTRUCTION_NODE',
                'documentTypeNode': 'document.DOCUMENT_TYPE_NODE',
                'isConnected': 'typeof document.isConnected !== "undefined"',

                // Security
                'isSecureContext': 'window.isSecureContext',
                'locationProtocol': 'window.location.protocol',
                'activeXObject': 'typeof window.ActiveXObject !== "undefined"',
                'msCredentials': 'typeof window.MSCredentials !== "undefined"',
                'ontouchstart': 'typeof window.ontouchstart !== "undefined"',
                'ondevicelight': 'typeof window.ondevicelight !== "undefined"',
                'persistent': 'typeof window.PERSISTENT !== "undefined"',
                'temporary': 'typeof window.TEMPORARY !== "undefined"',

                // API Overrides
                'permissionsQuery': 'navigator.permissions.query.toString()',
                'dateNow': 'Date.now.toString()',
                'mathRandom': 'Math.random.toString()',
                'performanceNow': 'performance.now.toString()',
                'jsonStringify': 'JSON.stringify.toString()',
                'objectDefineProperty': 'Object.defineProperty.toString()',
                'setTimeoutOverride': 'setTimeout.toString()',
                'setIntervalOverride': 'setInterval.toString()',

                // AI Agent Detection
                'funcToString': 'Function.prototype.toString.toString()',
                'errorToString': 'Error.prototype.toString.toString()',
                'addEventListener': 'EventTarget.prototype.addEventListener.toString()',
                'dispatchEvent': 'EventTarget.prototype.dispatchEvent.toString()',
                'querySelector': 'Document.prototype.querySelector.toString()',
                'querySelectorAll': 'Document.prototype.querySelectorAll.toString()',
                'getComputedStyle': 'getComputedStyle.toString()',
                'createElement': 'Document.prototype.createElement.toString()',
                'appendChild': 'Node.prototype.appendChild.toString()',
                'removeChild': 'Node.prototype.removeChild.toString()',
                'canvasToDataURL': 'HTMLCanvasElement.prototype.toDataURL.toString()',
                'canvasGetContext': 'HTMLCanvasElement.prototype.getContext.toString()',
                'webglGetParameter': 'WebGLRenderingContext.prototype.getParameter.toString()',
                'fetchSig': 'fetch.toString()',
                'xmlHttpRequest': 'XMLHttpRequest.toString()',
                'websocketSig': 'WebSocket.toString()',
                'requestAnimationFrame': 'requestAnimationFrame.toString()',
                'cancelAnimationFrame': 'cancelAnimationFrame.toString()',
                'navigatorUAGetter': 'Object.getOwnPropertyDescriptor(Navigator.prototype, "userAgent").get.toString()',
                'navigatorLangGetter': 'Object.getOwnPropertyDescriptor(Navigator.prototype, "languages").get.toString()',
                'navigatorPlatformGetter': 'Object.getOwnPropertyDescriptor(Navigator.prototype, "platform").get.toString()',
                'navigatorVendorGetter': 'Object.getOwnPropertyDescriptor(Navigator.prototype, "vendor").get.toString()',
                'navigatorWebdriverGetter': 'Object.getOwnPropertyDescriptor(Navigator.prototype, "webdriver").get.toString()',
                'geolocationGetCurrentPosition': 'navigator.geolocation.getCurrentPosition.toString()',
                'geolocationWatchPosition': 'navigator.geolocation.watchPosition.toString()',
                'clipboardRead': 'navigator.clipboard.read.toString()',
                'clipboardWrite': 'navigator.clipboard.write.toString()',
                'localStorageSetItem': 'Storage.prototype.setItem.toString()',
                'localStorageGetItem': 'Storage.prototype.getItem.toString()',
                'getUserMedia': 'navigator.mediaDevices.getUserMedia.toString()',
                'cryptoGetRandomValues': 'crypto.getRandomValues.toString()',
                'cryptoRandomUUID': 'crypto.randomUUID.toString()',
                'crossRealm_funcToString_diff': 'Cross-realm Function.toString comparison',
                'crossRealm_JSON_stringify_diff': 'Cross-realm JSON.stringify comparison',
                'crossRealm_Object_defineProperty_diff': 'Cross-realm Object.defineProperty comparison',
                'crossRealm_navigator_userAgent_getter_diff': 'Cross-realm Navigator.userAgent getter comparison',
                'proxy_permissionsQuery_proxied': 'Proxy detection for permissions.query',
                'proxy_setTimeout_proxied': 'Proxy detection for setTimeout',
                'proxy_funcToString_proxied': 'Proxy detection for Function.toString',
                'proxy_fetch_proxied': 'Proxy detection for fetch',
                'contextConsistency': 'Advanced cross-context execution consistency analysis',
                'permissionsTests': 'Permissions API behavior tests',

                // String Signature Automation Detection
                'setTimeout_signature': '(Error.toString()).replace(/\\s/g, "") === ((setTimeout.toString()).replace(/setTimeout/g, "Error")).replace(/\\s/g, "")',
                'setInterval_signature': '(Error.toString()).replace(/\\s/g, "") === ((setInterval.toString()).replace(/setInterval/g, "Error")).replace(/\\s/g, "")',
                'function_bind_signature': '(Error.toString()).replace(/\\s/g, "") === ((Function.prototype.bind.toString()).replace(/bind/g, "Error")).replace(/\\s/g, "")',
                'function_toString_signature': '(Error.toString()).replace(/\\s/g, "") === ((Function.prototype.toString.toString()).replace(/toString/g, "Error")).replace(/\\s/g, "")',
                'function_bind_availability': 'typeof Function.prototype.bind === "function"',
                'phantomjs_stack_trace': '(new Error()).stack.match(/phantomjs/gi) !== null'
            };

            return codeMap[metricName] || `${category}.${metricName}`;
        }

        // Helper functions
        function formatCategoryName(name) {
            const categoryNames = {
                navigator: 'üß≠ Navigator Properties',
                display: 'üñ•Ô∏è Display & Screen',
                window: 'ü™ü Window Properties',
                automation: 'ü§ñ Automation Detection',
                jsEnvironment: '‚öôÔ∏è JavaScript Environment',
                graphics: 'üé® Graphics & WebGL',
                performance: '‚ö° Performance Metrics',
                webApis: 'üîå Web APIs',
                document: 'üìÑ Document Properties',
                security: 'üîí Security Features',
                apiOverrides: 'üîç API Overrides',
                aiAgentDetection: 'üïµÔ∏è AI Agent Detection',
                stringSignatureAutomation: 'üî¨ String Signature Automation Detection',
                behavioralIndicators: 'üéØ Behavioral Indicators'
            };
            return categoryNames[name] || name;
        }

        function formatMetricName(name) {
            return name.replace(/([A-Z])/g, ' $1')
                      .replace(/^./, str => str.toUpperCase())
                      .replace(/([a-z])([A-Z])/g, '$1 $2');
        }

        function formatValue(value) {
            if (typeof value === 'boolean') {
                return value ? 'True' : 'False';
            }
            if (typeof value === 'string' && value.length > 50) {
                return value.substring(0, 47) + '...';
            }
            if (value === null || value === undefined) {
                return 'Not available';
            }
            return String(value);
        }

        // Export functionality
        window.exportFingerprintData = function(format) {
            if (!fingerprintData) {
                alert('No fingerprint data available for export');
                return;
            }

            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            const filename = `browser-fingerprint-${timestamp}`;

            if (format === 'json') {
                const dataStr = JSON.stringify(fingerprintData, null, 2);
                downloadFile(dataStr, `${filename}.json`, 'application/json');
            } else if (format === 'csv') {
                const csvData = convertToCSV(fingerprintData.metrics);
                downloadFile(csvData, `${filename}.csv`, 'text/csv');
            }
        };

        function convertToCSV(metrics) {
            const rows = [['Category', 'Metric', 'Value', 'Description', 'Risk Level']];
            
            for (const [category, categoryMetrics] of Object.entries(metrics)) {
                for (const [metric, data] of Object.entries(categoryMetrics)) {
                    rows.push([
                        category,
                        metric,
                        String(data.value),
                        data.description,
                        data.risk || 'N/A'
                    ]);
                }
            }
            
            return rows.map(row => 
                row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(',')
            ).join('\\n');
        }

        function downloadFile(content, filename, contentType) {
            const a = document.createElement('a');
            const file = new Blob([content], { type: contentType });
            a.href = URL.createObjectURL(file);
            a.download = filename;
            a.click();
            URL.revokeObjectURL(a.href);
        }

        // Start analysis when page loads
        document.addEventListener('DOMContentLoaded', initializeAnalysis);
    </script>
</body>
</html>
