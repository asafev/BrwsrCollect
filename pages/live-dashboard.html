<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Dashboard - AI Agent Detection Framework</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto auto auto;
            gap: 20px;
            margin: 20px 0;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
        }
        
        .dashboard-card.full-width {
            grid-column: 1 / -1;
        }
        
        .metric-display {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 15px 0;
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .metric-label {
            font-size: 1rem;
            color: #666;
            margin-top: 5px;
        }
        
        .metric-change {
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .metric-change.positive {
            color: var(--accent-color);
        }
        
        .metric-change.neutral {
            color: var(--success-color);
        }
        
        .threat-level {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .threat-level.low {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }
        
        .threat-level.medium {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }
        
        .threat-level.high {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .live-feed {
            background: #1a1a1a;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 20px;
            border-radius: 10px;
            height: 400px;
            overflow-y: auto;
            margin: 15px 0;
            border: 2px solid #333;
        }
        
        .feed-line {
            margin: 5px 0;
            padding: 3px 0;
            opacity: 0;
            animation: feedFadeIn 0.5s ease forwards;
        }
        
        @keyframes feedFadeIn {
            to { opacity: 1; }
        }
        
        .alert-critical { color: #ff4757; }
        .alert-warning { color: #ffa502; }
        .alert-info { color: #3742fa; }
        .alert-success { color: #2ed573; }
        
        .detection-chart {
            height: 300px;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: end;
            justify-content: space-around;
            padding: 20px;
            margin: 15px 0;
        }
        
        .chart-bar {
            background: var(--secondary-color);
            border-radius: 4px 4px 0 0;
            min-width: 30px;
            transition: height 0.3s ease;
            position: relative;
            margin: 0 5px;
        }
        
        .chart-bar.critical {
            background: var(--accent-color);
        }
        
        .chart-bar.warning {
            background: var(--warning-color);
        }
        
        .chart-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            color: #666;
        }
        
        .chart-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            font-weight: bold;
            color: #333;
        }
        
        .system-health {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .health-metric {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid transparent;
        }
        
        .health-metric.healthy {
            border-color: var(--success-color);
        }
        
        .health-metric.warning {
            border-color: var(--warning-color);
        }
        
        .health-metric.critical {
            border-color: var(--accent-color);
        }
        
        .active-threats {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .threat-item {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid var(--accent-color);
        }
        
        .threat-item.medium {
            background: #fffbeb;
            border-color: #fbd38d;
            border-left-color: var(--warning-color);
        }
        
        .threat-title {
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 5px;
        }
        
        .threat-details {
            font-size: 0.9rem;
            color: #666;
        }
        
        .control-panel {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .status-indicator.active {
            background: #d4edda;
            color: #155724;
        }
        
        .status-indicator.inactive {
            background: #f8d7da;
            color: #721c24;
        }
        
        .pulse-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }
        
        .ai-agent-alerts {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }
        
        .alert-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .alert-box {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .alert-box.detected {
            background: rgba(255,107,107,0.3);
            border: 2px solid #ff6b6b;
            animation: alertPulse 2s infinite;
        }
        
        @keyframes alertPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .refresh-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 10px 0;
        }
        
        .auto-refresh-indicator {
            color: var(--success-color);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">üìä Live Dashboard</div>
            <div>
                <span class="status" id="dashboard-status">Active</span>
            </div>
        </div>
    </header>

    <nav>
        <div class="nav-container">
            <ul class="nav-menu">
                <li class="nav-item"><a href="../index.html" class="nav-link">Dashboard</a></li>
                <li class="nav-item"><a href="dom-monitor.html" class="nav-link">DOM Monitor</a></li>
                <li class="nav-item"><a href="extension-detector.html" class="nav-link">Extensions</a></li>
                <li class="nav-item"><a href="stylesheet-monitor.html" class="nav-link">Stylesheets</a></li>
                <li class="nav-item"><a href="overlay-detector.html" class="nav-link">Overlays</a></li>
                <li class="nav-item"><a href="live-dashboard.html" class="nav-link active">Live Dashboard</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="ai-agent-alerts">
            <h2>ü§ñ AI Agent Detection Status</h2>
            <div class="alert-grid" id="ai-agent-grid">
                <div class="alert-box" id="openai-alert">
                    <h4>OpenAI Operator</h4>
                    <div id="openai-status">Not Detected</div>
                </div>
                <div class="alert-box" id="comet-alert">
                    <h4>Perplexity Comet</h4>
                    <div id="comet-status">Not Detected</div>
                </div>
                <div class="alert-box" id="automation-alert">
                    <h4>Automation Tools</h4>
                    <div id="automation-status">Not Detected</div>
                </div>
                <div class="alert-box" id="extension-alert">
                    <h4>Extensions</h4>
                    <div id="extension-status">Not Detected</div>
                </div>
            </div>
        </div>

        <div class="control-panel">
            <button id="start-all-monitoring" class="btn btn-success">Start All Monitoring</button>
            <button id="stop-all-monitoring" class="btn btn-danger">Stop All Monitoring</button>
            <button id="export-dashboard" class="btn btn-primary">Export Report</button>
            <button id="clear-all-data" class="btn btn-warning">Clear All Data</button>
            
            <div class="refresh-controls">
                <label>
                    <input type="checkbox" id="auto-refresh" checked> Auto-refresh
                </label>
                <span class="auto-refresh-indicator" id="refresh-indicator">‚óè Live</span>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h3>üîç Detection Metrics</h3>
                <div class="metric-display">
                    <div>
                        <div class="metric-value" id="total-detections">0</div>
                        <div class="metric-label">Total Detections</div>
                    </div>
                    <div class="metric-change neutral" id="detection-change">+0</div>
                </div>
                <div class="metric-display">
                    <div>
                        <div class="metric-value" id="critical-threats">0</div>
                        <div class="metric-label">Critical Threats</div>
                    </div>
                    <div class="metric-change neutral" id="threat-change">+0</div>
                </div>
            </div>

            <div class="dashboard-card">
                <h3>‚ö†Ô∏è Threat Level</h3>
                <div class="threat-level low" id="threat-level">
                    LOW RISK
                    <div style="font-size: 0.8rem; margin-top: 10px;">No significant threats detected</div>
                </div>
            </div>

            <div class="dashboard-card full-width">
                <h3>üìà Detection Activity Chart</h3>
                <div class="detection-chart" id="activity-chart">
                    <!-- Chart bars will be generated here -->
                </div>
            </div>

            <div class="dashboard-card">
                <h3>üíΩ System Health</h3>
                <div class="system-health">
                    <div class="health-metric healthy" id="dom-health">
                        <div><strong>DOM Monitor</strong></div>
                        <div id="dom-health-status">Healthy</div>
                    </div>
                    <div class="health-metric healthy" id="css-health">
                        <div><strong>CSS Monitor</strong></div>
                        <div id="css-health-status">Healthy</div>
                    </div>
                    <div class="health-metric healthy" id="overlay-health">
                        <div><strong>Overlay Detector</strong></div>
                        <div id="overlay-health-status">Healthy</div>
                    </div>
                    <div class="health-metric healthy" id="extension-health">
                        <div><strong>Extension Scanner</strong></div>
                        <div id="extension-health-status">Healthy</div>
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <h3>üö® Active Threats</h3>
                <div class="active-threats" id="active-threats">
                    <div style="text-align: center; color: #666; padding: 20px;">
                        No active threats detected
                    </div>
                </div>
            </div>

            <div class="dashboard-card full-width">
                <h3>üì° Live Detection Feed</h3>
                <div class="live-feed" id="live-feed">
                    <div class="feed-line alert-success">[INIT] AI Agent Detection Dashboard started</div>
                    <div class="feed-line alert-info">[INFO] All monitoring systems initializing...</div>
                    <div class="feed-line alert-success">[OK] Dashboard ready - monitoring for AI agents</div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3 class="card-title">üìä Detection Statistics</h3>
                <p class="card-subtitle">Detailed breakdown of detection events</p>
            </div>
            <div class="grid grid-3">
                <div class="stat-card">
                    <div class="stat-number" id="dom-mutations">0</div>
                    <div class="stat-label">DOM Mutations</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="style-injections">0</div>
                    <div class="stat-label">Style Injections</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="overlay-detections">0</div>
                    <div class="stat-label">Overlay Detections</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="extension-detections">0</div>
                    <div class="stat-label">Extension Detections</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="ai-agent-detections">0</div>
                    <div class="stat-label">AI Agent Detections</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="automation-detections">0</div>
                    <div class="stat-label">Automation Detections</div>
                </div>
            </div>
        </div>
    </div>

    <script src="../js/ai-detector.js"></script>
    <script>
        let dashboardActive = true;
        let refreshInterval = null;
        let detectionHistory = [];
        let currentThreats = [];
        let activityData = [];
        let previousMetrics = {
            totalDetections: 0,
            criticalThreats: 0
        };

        // Initialize dashboard
        function initializeDashboard() {
            setupEventListeners();
            initializeActivityChart();
            startAutoRefresh();
            setupAIDetectorIntegration();
            updateDashboard();
            logToFeed('Dashboard initialized and monitoring started', 'success');
        }

        function setupEventListeners() {
            document.getElementById('start-all-monitoring').addEventListener('click', startAllMonitoring);
            document.getElementById('stop-all-monitoring').addEventListener('click', stopAllMonitoring);
            document.getElementById('export-dashboard').addEventListener('click', exportDashboardReport);
            document.getElementById('clear-all-data').addEventListener('click', clearAllData);
            document.getElementById('auto-refresh').addEventListener('change', toggleAutoRefresh);
        }

        function setupAIDetectorIntegration() {
            // Listen for detections from the AI detector
            aiDetector.onDetection((detection) => {
                handleDetection(detection);
            });

            // Start monitoring if not already active
            if (!aiDetector.isMonitoring) {
                aiDetector.startMonitoring();
            }
        }

        function handleDetection(detection) {
            detectionHistory.push({
                ...detection,
                dashboardTimestamp: Date.now()
            });

            // Update activity data
            updateActivityData(detection);

            // Check if it's a threat
            if (detection.level === 'danger' || detection.level === 'warning') {
                addThreat(detection);
            }

            // Update AI agent alerts
            updateAIAgentAlerts(detection);

            // Log to feed
            const levelClass = getLevelClass(detection.level);
            logToFeed(`[${detection.type.toUpperCase()}] ${detection.message}`, levelClass);

            // Update dashboard
            updateDashboard();
        }

        function updateActivityData(detection) {
            const now = new Date();
            const hour = now.getHours();
            
            if (!activityData[hour]) {
                activityData[hour] = { total: 0, critical: 0, warning: 0 };
            }
            
            activityData[hour].total++;
            if (detection.level === 'danger') activityData[hour].critical++;
            if (detection.level === 'warning') activityData[hour].warning++;
            
            // Keep only last 24 hours
            if (activityData.length > 24) {
                activityData = activityData.slice(-24);
            }
        }

        function addThreat(detection) {
            const threat = {
                id: Date.now(),
                type: detection.type,
                message: detection.message,
                level: detection.level,
                timestamp: new Date(),
                details: detection.details
            };

            currentThreats.unshift(threat);

            // Keep only last 20 threats
            if (currentThreats.length > 20) {
                currentThreats = currentThreats.slice(0, 20);
            }

            updateActiveThreats();
        }

        function updateAIAgentAlerts(detection) {
            // Update specific AI agent alerts based on detection type
            if (detection.type === 'ai_agent_detected' || detection.message.includes('Comet')) {
                updateAlertBox('comet-alert', 'comet-status', 'DETECTED', true);
            }
            
            if (detection.type === 'automation_detected' || detection.message.includes('WebDriver')) {
                updateAlertBox('automation-alert', 'automation-status', 'DETECTED', true);
            }
            
            if (detection.type === 'extension_detected') {
                updateAlertBox('extension-alert', 'extension-status', 'DETECTED', true);
            }

            // Check for OpenAI patterns
            if (detection.message.includes('OpenAI') || detection.message.includes('Signature-Agent')) {
                updateAlertBox('openai-alert', 'openai-status', 'DETECTED', true);
            }
        }

        function updateAlertBox(boxId, statusId, message, isDetected) {
            const box = document.getElementById(boxId);
            const status = document.getElementById(statusId);
            
            status.textContent = message;
            
            if (isDetected) {
                box.classList.add('detected');
            } else {
                box.classList.remove('detected');
            }
        }

        function updateDashboard() {
            updateMetrics();
            updateThreatLevel();
            updateSystemHealth();
            updateActivityChart();
        }

        function updateMetrics() {
            const totalDetections = detectionHistory.length;
            const criticalThreats = currentThreats.filter(t => t.level === 'danger').length;

            // Calculate changes
            const detectionChange = totalDetections - previousMetrics.totalDetections;
            const threatChange = criticalThreats - previousMetrics.criticalThreats;

            // Update displays
            document.getElementById('total-detections').textContent = totalDetections;
            document.getElementById('critical-threats').textContent = criticalThreats;

            updateChangeIndicator('detection-change', detectionChange);
            updateChangeIndicator('threat-change', threatChange);

            // Update detailed stats
            updateDetailedStats();

            // Store for next comparison
            previousMetrics = { totalDetections, criticalThreats };
        }

        function updateChangeIndicator(elementId, change) {
            const element = document.getElementById(elementId);
            element.textContent = change >= 0 ? `+${change}` : change.toString();
            
            if (change > 0) {
                element.className = 'metric-change positive';
            } else if (change < 0) {
                element.className = 'metric-change negative';
            } else {
                element.className = 'metric-change neutral';
            }
        }

        function updateDetailedStats() {
            const stats = {
                domMutations: detectionHistory.filter(d => d.type.includes('dom')).length,
                styleInjections: detectionHistory.filter(d => d.type.includes('style')).length,
                overlayDetections: detectionHistory.filter(d => d.type.includes('overlay')).length,
                extensionDetections: detectionHistory.filter(d => d.type.includes('extension')).length,
                aiAgentDetections: detectionHistory.filter(d => d.type.includes('ai_agent')).length,
                automationDetections: detectionHistory.filter(d => d.type.includes('automation')).length
            };

            document.getElementById('dom-mutations').textContent = stats.domMutations;
            document.getElementById('style-injections').textContent = stats.styleInjections;
            document.getElementById('overlay-detections').textContent = stats.overlayDetections;
            document.getElementById('extension-detections').textContent = stats.extensionDetections;
            document.getElementById('ai-agent-detections').textContent = stats.aiAgentDetections;
            document.getElementById('automation-detections').textContent = stats.automationDetections;
        }

        function updateThreatLevel() {
            const criticalCount = currentThreats.filter(t => t.level === 'danger').length;
            const warningCount = currentThreats.filter(t => t.level === 'warning').length;
            
            const threatLevel = document.getElementById('threat-level');
            
            if (criticalCount > 0) {
                threatLevel.className = 'threat-level high';
                threatLevel.innerHTML = `
                    HIGH RISK
                    <div style="font-size: 0.8rem; margin-top: 10px;">${criticalCount} critical threat(s) detected</div>
                `;
            } else if (warningCount > 0) {
                threatLevel.className = 'threat-level medium';
                threatLevel.innerHTML = `
                    MEDIUM RISK
                    <div style="font-size: 0.8rem; margin-top: 10px;">${warningCount} warning(s) detected</div>
                `;
            } else {
                threatLevel.className = 'threat-level low';
                threatLevel.innerHTML = `
                    LOW RISK
                    <div style="font-size: 0.8rem; margin-top: 10px;">No significant threats detected</div>
                `;
            }
        }

        function updateSystemHealth() {
            // Simulate system health based on recent activity
            const recentDetections = detectionHistory.filter(d => 
                Date.now() - d.dashboardTimestamp < 30000 // Last 30 seconds
            );

            const systems = ['dom-health', 'css-health', 'overlay-health', 'extension-health'];
            const statuses = ['dom-health-status', 'css-health-status', 'overlay-health-status', 'extension-health-status'];

            systems.forEach((systemId, index) => {
                const systemElement = document.getElementById(systemId);
                const statusElement = document.getElementById(statuses[index]);
                
                const systemDetections = recentDetections.filter(d => 
                    d.type.includes(systemId.split('-')[0])
                ).length;

                if (systemDetections > 5) {
                    systemElement.className = 'health-metric critical';
                    statusElement.textContent = 'High Activity';
                } else if (systemDetections > 2) {
                    systemElement.className = 'health-metric warning';
                    statusElement.textContent = 'Active';
                } else {
                    systemElement.className = 'health-metric healthy';
                    statusElement.textContent = 'Healthy';
                }
            });
        }

        function updateActiveThreats() {
            const container = document.getElementById('active-threats');
            
            if (currentThreats.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: #666; padding: 20px;">
                        No active threats detected
                    </div>
                `;
                return;
            }

            container.innerHTML = '';
            currentThreats.slice(0, 5).forEach(threat => {
                const threatDiv = document.createElement('div');
                threatDiv.className = `threat-item ${threat.level === 'warning' ? 'medium' : ''}`;
                
                threatDiv.innerHTML = `
                    <div class="threat-title">${threat.message}</div>
                    <div class="threat-details">
                        Type: ${threat.type} | Time: ${threat.timestamp.toLocaleTimeString()}
                        ${threat.details ? `<br>Details: ${JSON.stringify(threat.details).substring(0, 100)}...` : ''}
                    </div>
                `;
                
                container.appendChild(threatDiv);
            });
        }

        function initializeActivityChart() {
            const chart = document.getElementById('activity-chart');
            chart.innerHTML = '';
            
            // Create 24 bars for hours
            for (let i = 0; i < 24; i++) {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = '10px';
                
                const label = document.createElement('div');
                label.className = 'chart-label';
                label.textContent = i.toString().padStart(2, '0');
                
                const value = document.createElement('div');
                value.className = 'chart-value';
                value.textContent = '0';
                
                bar.appendChild(label);
                bar.appendChild(value);
                chart.appendChild(bar);
            }
        }

        function updateActivityChart() {
            const bars = document.querySelectorAll('.chart-bar');
            const maxValue = Math.max(...Object.values(activityData).map(d => d ? d.total : 0), 1);
            
            bars.forEach((bar, index) => {
                const data = activityData[index] || { total: 0, critical: 0, warning: 0 };
                const height = Math.max((data.total / maxValue) * 250, 10);
                
                bar.style.height = height + 'px';
                
                if (data.critical > 0) {
                    bar.className = 'chart-bar critical';
                } else if (data.warning > 0) {
                    bar.className = 'chart-bar warning';
                } else {
                    bar.className = 'chart-bar';
                }
                
                const valueElement = bar.querySelector('.chart-value');
                valueElement.textContent = data.total.toString();
            });
        }

        function startAutoRefresh() {
            if (refreshInterval) clearInterval(refreshInterval);
            
            refreshInterval = setInterval(() => {
                if (document.getElementById('auto-refresh').checked) {
                    updateDashboard();
                    updateRefreshIndicator();
                }
            }, 2000);
        }

        function toggleAutoRefresh() {
            const autoRefresh = document.getElementById('auto-refresh').checked;
            const indicator = document.getElementById('refresh-indicator');
            
            if (autoRefresh) {
                indicator.textContent = '‚óè Live';
                indicator.style.color = 'var(--success-color)';
                startAutoRefresh();
            } else {
                indicator.textContent = '‚óã Paused';
                indicator.style.color = '#999';
                if (refreshInterval) {
                    clearInterval(refreshInterval);
                    refreshInterval = null;
                }
            }
        }

        function updateRefreshIndicator() {
            const indicator = document.getElementById('refresh-indicator');
            indicator.style.opacity = '0.5';
            setTimeout(() => {
                indicator.style.opacity = '1';
            }, 100);
        }

        function logToFeed(message, level = 'info') {
            const feed = document.getElementById('live-feed');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = getLogPrefix(level);
            
            const line = document.createElement('div');
            line.className = `feed-line alert-${level}`;
            line.textContent = `[${timestamp}] ${prefix} ${message}`;
            
            feed.appendChild(line);
            feed.scrollTop = feed.scrollHeight;

            // Keep only last 100 lines
            while (feed.children.length > 100) {
                feed.removeChild(feed.firstChild);
            }
        }

        function getLevelClass(level) {
            const levelMap = {
                'danger': 'critical',
                'warning': 'warning',
                'info': 'info',
                'success': 'success'
            };
            return levelMap[level] || 'info';
        }

        function getLogPrefix(level) {
            const prefixMap = {
                'critical': '[ALERT]',
                'warning': '[WARN]',
                'info': '[INFO]',
                'success': '[OK]'
            };
            return prefixMap[level] || '[INFO]';
        }

        function startAllMonitoring() {
            aiDetector.startMonitoring();
            logToFeed('All monitoring systems started', 'success');
        }

        function stopAllMonitoring() {
            aiDetector.stopMonitoring();
            logToFeed('All monitoring systems stopped', 'warning');
        }

        function exportDashboardReport() {
            const report = {
                timestamp: new Date().toISOString(),
                summary: {
                    totalDetections: detectionHistory.length,
                    criticalThreats: currentThreats.filter(t => t.level === 'danger').length,
                    warningThreats: currentThreats.filter(t => t.level === 'warning').length,
                    monitoringDuration: Date.now() - (detectionHistory[0]?.dashboardTimestamp || Date.now())
                },
                detectionHistory: detectionHistory,
                currentThreats: currentThreats,
                activityData: activityData,
                aiAgentAlerts: {
                    openai: document.getElementById('openai-status').textContent,
                    comet: document.getElementById('comet-status').textContent,
                    automation: document.getElementById('automation-status').textContent,
                    extensions: document.getElementById('extension-status').textContent
                },
                systemHealth: {
                    dom: document.getElementById('dom-health-status').textContent,
                    css: document.getElementById('css-health-status').textContent,
                    overlay: document.getElementById('overlay-health-status').textContent,
                    extension: document.getElementById('extension-health-status').textContent
                }
            };

            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ai-agent-dashboard-report-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            logToFeed('Dashboard report exported', 'success');
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear all detection data?')) {
                detectionHistory = [];
                currentThreats = [];
                activityData = [];
                aiDetector.clearResults();
                
                // Reset UI
                updateDashboard();
                updateActiveThreats();
                initializeActivityChart();
                
                // Reset AI agent alerts
                updateAlertBox('openai-alert', 'openai-status', 'Not Detected', false);
                updateAlertBox('comet-alert', 'comet-status', 'Not Detected', false);
                updateAlertBox('automation-alert', 'automation-status', 'Not Detected', false);
                updateAlertBox('extension-alert', 'extension-status', 'Not Detected', false);
                
                logToFeed('All detection data cleared', 'info');
            }
        }

        // Auto-run tests to demonstrate functionality
        function runDemoDetections() {
            setTimeout(() => {
                // Simulate some detections for demo purposes
                logToFeed('Running demonstration detections...', 'info');
                
                setTimeout(() => {
                    handleDetection({
                        type: 'dom_injection',
                        level: 'warning',
                        message: 'Demo: Suspicious DOM element detected',
                        details: { element: 'DIV', pattern: 'test-pattern' }
                    });
                }, 2000);
                
                setTimeout(() => {
                    handleDetection({
                        type: 'style_manipulation',
                        level: 'info',
                        message: 'Demo: Style modification detected',
                        details: { property: 'z-index', value: '99999' }
                    });
                }, 4000);
                
                setTimeout(() => {
                    handleDetection({
                        type: 'automation_detected',
                        level: 'danger',
                        message: 'Demo: Automation framework detected',
                        details: { framework: 'demo-automation' }
                    });
                }, 6000);
                
            }, 3000);
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            initializeDashboard();
            // Run demo only if requested
            if (window.location.search.includes('demo=true')) {
                runDemoDetections();
            }
        });
    </script>
</body>
</html>
