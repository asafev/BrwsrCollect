<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOM Monitor - AI Agent Detection Framework</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .mutation-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .mutation-type {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .mutation-details {
            color: #6c757d;
            margin-left: 20px;
        }
        
        .element-tree {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .tree-node {
            margin: 5px 0;
            padding: 5px 10px;
            border-left: 2px solid #dee2e6;
            cursor: pointer;
        }
        
        .tree-node:hover {
            background: #f8f9fa;
        }
        
        .tree-node.suspicious {
            border-left-color: var(--accent-color);
            background: #fdf2f2;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: var(--shadow);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .filter-controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: var(--shadow);
        }
        
        .filter-group {
            display: flex;
            gap: 15px;
            align-items: center;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .filter-group label {
            font-weight: 500;
            color: var(--primary-color);
        }
        
        .real-time-feed {
            background: #1e1e1e;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 20px;
            border-radius: 8px;
            height: 300px;
            overflow-y: auto;
            margin: 20px 0;
        }
        
        .feed-line {
            margin: 2px 0;
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .highlight-red { color: #ff6b6b; }
        .highlight-yellow { color: #ffd93d; }
        .highlight-green { color: #6bcf7f; }
        .highlight-blue { color: #4dabf7; }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">üîç DOM Monitor</div>
            <div>
                <span class="status" id="monitor-status">Inactive</span>
            </div>
        </div>
    </header>

    <nav>
        <div class="nav-container">
            <ul class="nav-menu">
                <li class="nav-item"><a href="../index.html" class="nav-link">Dashboard</a></li>
                <li class="nav-item"><a href="dom-monitor.html" class="nav-link active">DOM Monitor</a></li>
                <li class="nav-item"><a href="extension-detector.html" class="nav-link">Extensions</a></li>
                <li class="nav-item"><a href="stylesheet-monitor.html" class="nav-link">Stylesheets</a></li>
                <li class="nav-item"><a href="overlay-detector.html" class="nav-link">Overlays</a></li>
                <li class="nav-item"><a href="live-dashboard.html" class="nav-link">Live Dashboard</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">üîç DOM Mutation Monitor</h2>
                <p class="card-subtitle">Real-time tracking of DOM changes to detect AI agent manipulations</p>
            </div>
            
            <div class="filter-controls">
                <h3>Monitor Controls</h3>
                <div class="filter-group">
                    <button id="start-dom-monitor" class="btn btn-success">Start Monitoring</button>
                    <button id="stop-dom-monitor" class="btn btn-danger">Stop Monitoring</button>
                    <button id="clear-mutations" class="btn btn-warning">Clear History</button>
                    <button id="snapshot-dom" class="btn btn-primary">Take DOM Snapshot</button>
                </div>
                
                <div class="filter-group">
                    <label>Filter by type:</label>
                    <label><input type="checkbox" id="filter-childList" checked> Child List</label>
                    <label><input type="checkbox" id="filter-attributes" checked> Attributes</label>
                    <label><input type="checkbox" id="filter-characterData"> Character Data</label>
                    <label><input type="checkbox" id="filter-subtree" checked> Subtree</label>
                </div>
                
                <div class="filter-group">
                    <label>Suspicious patterns:</label>
                    <label><input type="checkbox" id="filter-agent" checked> AI Agent patterns</label>
                    <label><input type="checkbox" id="filter-overlay" checked> Overlay elements</label>
                    <label><input type="checkbox" id="filter-zindex" checked> High z-index</label>
                    <label><input type="checkbox" id="filter-extension" checked> Extension related</label>
                </div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="total-mutations">0</div>
                <div class="stat-label">Total Mutations</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="suspicious-mutations">0</div>
                <div class="stat-label">Suspicious Mutations</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="elements-added">0</div>
                <div class="stat-label">Elements Added</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="elements-removed">0</div>
                <div class="stat-label">Elements Removed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="attribute-changes">0</div>
                <div class="stat-label">Attribute Changes</div>
            </div>
        </div>

        <div class="grid grid-2">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üìä Real-time Feed</h3>
                    <p class="card-subtitle">Live stream of DOM mutations</p>
                </div>
                <div class="real-time-feed" id="mutation-feed">
                    <div class="feed-line">DOM Monitor initialized</div>
                    <div class="feed-line">Waiting for mutations...</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">‚ö†Ô∏è Suspicious Activity</h3>
                    <p class="card-subtitle">Potentially malicious DOM changes</p>
                </div>
                <div id="suspicious-activity">
                    <div class="detection-result safe">
                        <div class="result-message">No suspicious activity detected</div>
                        <div class="result-details">System monitoring for AI agent patterns</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3 class="card-title">üå≥ DOM Tree Analysis</h3>
                <p class="card-subtitle">Current DOM structure with suspicious elements highlighted</p>
            </div>
            <button id="analyze-dom" class="btn btn-primary">Analyze Current DOM</button>
            <div class="element-tree" id="dom-tree">
                Click "Analyze Current DOM" to see the structure
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3 class="card-title">üìã Mutation History</h3>
                <p class="card-subtitle">Detailed log of all DOM changes</p>
            </div>
            <div id="mutation-history">
                <div class="mutation-display">
                    <div class="mutation-type">System Ready</div>
                    <div class="mutation-details">DOM monitoring system initialized and ready to track changes</div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3 class="card-title">üß™ Test DOM Manipulations</h3>
                <p class="card-subtitle">Create test scenarios to verify detection capabilities</p>
            </div>
            <div class="filter-group">
                <button id="test-add-element" class="btn btn-warning">Test: Add Element</button>
                <button id="test-modify-style" class="btn btn-warning">Test: Modify Style</button>
                <button id="test-inject-overlay" class="btn btn-warning">Test: Inject Overlay</button>
                <button id="test-agent-pattern" class="btn btn-warning">Test: AI Agent Pattern</button>
                <button id="test-extension-inject" class="btn btn-warning">Test: Extension Injection</button>
            </div>
        </div>
    </div>

    <script src="../js/ai-detector.js"></script>
    <script>
        let domMonitorActive = false;
        let mutationCount = 0;
        let suspiciousCount = 0;
        let elementsAdded = 0;
        let elementsRemoved = 0;
        let attributeChanges = 0;
        let mutationHistory = [];

        // DOM Monitor specific observer
        let domObserver = null;

        // Initialize
        function initializeDOMMonitor() {
            // Set up event listeners
            document.getElementById('start-dom-monitor').addEventListener('click', startDOMMonitor);
            document.getElementById('stop-dom-monitor').addEventListener('click', stopDOMMonitor);
            document.getElementById('clear-mutations').addEventListener('click', clearMutations);
            document.getElementById('snapshot-dom').addEventListener('click', takeDOMSnapshot);
            document.getElementById('analyze-dom').addEventListener('click', analyzeDOMStructure);

            // Test buttons
            document.getElementById('test-add-element').addEventListener('click', testAddElement);
            document.getElementById('test-modify-style').addEventListener('click', testModifyStyle);
            document.getElementById('test-inject-overlay').addEventListener('click', testInjectOverlay);
            document.getElementById('test-agent-pattern').addEventListener('click', testAgentPattern);
            document.getElementById('test-extension-inject').addEventListener('click', testExtensionInject);

            updateStats();
            logToFeed('DOM Monitor ready', 'info');
        }

        function startDOMMonitor() {
            if (domMonitorActive) return;

            domObserver = new MutationObserver((mutations) => {
                mutations.forEach(mutation => processMutation(mutation));
            });

            domObserver.observe(document.documentElement, {
                childList: true,
                subtree: true,
                attributes: true,
                attributeOldValue: true,
                characterData: true,
                characterDataOldValue: true
            });

            domMonitorActive = true;
            updateMonitorStatus();
            logToFeed('DOM monitoring started', 'success');
        }

        function stopDOMMonitor() {
            if (!domMonitorActive) return;

            if (domObserver) {
                domObserver.disconnect();
                domObserver = null;
            }

            domMonitorActive = false;
            updateMonitorStatus();
            logToFeed('DOM monitoring stopped', 'warning');
        }

        function processMutation(mutation) {
            mutationCount++;
            
            const mutationData = {
                type: mutation.type,
                target: mutation.target,
                addedNodes: Array.from(mutation.addedNodes),
                removedNodes: Array.from(mutation.removedNodes),
                attributeName: mutation.attributeName,
                oldValue: mutation.oldValue,
                timestamp: new Date(),
                suspicious: false,
                suspicionReasons: []
            };

            // Analyze mutation for suspicious patterns
            analyzeMutationSuspicion(mutationData);

            // Update statistics
            if (mutation.type === 'childList') {
                elementsAdded += mutation.addedNodes.length;
                elementsRemoved += mutation.removedNodes.length;
            } else if (mutation.type === 'attributes') {
                attributeChanges++;
            }

            // Log to feed and history
            logMutationToFeed(mutationData);
            addToMutationHistory(mutationData);
            
            updateStats();

            // Check if should be filtered
            if (shouldDisplayMutation(mutationData)) {
                displayMutation(mutationData);
            }
        }

        function analyzeMutationSuspicion(mutationData) {
            const suspiciousPatterns = [
                'pplx-agent-overlay',
                'comet-agent',
                'ai-assistant',
                'bot-overlay',
                'automation-overlay',
                'extension-content',
                'injected-overlay',
                'stop-button',
                'agent-control'
            ];

            const highZIndexThreshold = 9999;

            // Check added nodes for suspicious patterns
            mutationData.addedNodes.forEach(node => {
                if (node.nodeType === Node.ELEMENT_NODE) {
                    const element = node;
                    const id = element.id || '';
                    const className = element.className || '';
                    const tagName = element.tagName || '';

                    // Check for suspicious IDs/classes
                    suspiciousPatterns.forEach(pattern => {
                        if (id.includes(pattern) || className.includes(pattern)) {
                            mutationData.suspicious = true;
                            mutationData.suspicionReasons.push(`Suspicious pattern: ${pattern}`);
                        }
                    });

                    // Check for high z-index
                    const style = window.getComputedStyle(element);
                    const zIndex = parseInt(style.zIndex) || 0;
                    if (zIndex > highZIndexThreshold) {
                        mutationData.suspicious = true;
                        mutationData.suspicionReasons.push(`High z-index: ${zIndex}`);
                    }

                    // Check for overlay characteristics
                    const rect = element.getBoundingClientRect();
                    const viewportArea = window.innerWidth * window.innerHeight;
                    const elementArea = rect.width * rect.height;
                    const coverage = elementArea / viewportArea;

                    if (coverage > 0.3 && 
                        (style.position === 'fixed' || style.position === 'absolute') &&
                        zIndex > 1000) {
                        mutationData.suspicious = true;
                        mutationData.suspicionReasons.push(`Large overlay detected (${Math.round(coverage * 100)}% coverage)`);
                    }
                }
            });

            // Check attribute changes for suspicious modifications
            if (mutationData.type === 'attributes') {
                const element = mutationData.target;
                const attrName = mutationData.attributeName;
                
                if (attrName === 'style') {
                    const newStyle = element.getAttribute('style') || '';
                    const suspiciousStyleProps = [
                        'position: fixed',
                        'position: absolute',
                        'z-index: 999',
                        'opacity: 0',
                        'visibility: hidden',
                        'pointer-events: none'
                    ];

                    suspiciousStyleProps.forEach(prop => {
                        if (newStyle.includes(prop)) {
                            mutationData.suspicious = true;
                            mutationData.suspicionReasons.push(`Suspicious style: ${prop}`);
                        }
                    });
                }
            }

            if (mutationData.suspicious) {
                suspiciousCount++;
                addSuspiciousActivity(mutationData);
            }
        }

        function logMutationToFeed(mutationData) {
            const feed = document.getElementById('mutation-feed');
            const timestamp = mutationData.timestamp.toLocaleTimeString();
            
            let message = `[${timestamp}] ${mutationData.type.toUpperCase()}`;
            let cssClass = 'highlight-blue';
            
            if (mutationData.suspicious) {
                message += ' [SUSPICIOUS]';
                cssClass = 'highlight-red';
            }

            if (mutationData.type === 'childList') {
                message += ` +${mutationData.addedNodes.length} -${mutationData.removedNodes.length}`;
            } else if (mutationData.type === 'attributes') {
                message += ` ${mutationData.attributeName}`;
            }

            const line = document.createElement('div');
            line.className = `feed-line ${cssClass}`;
            line.textContent = message;
            
            feed.appendChild(line);
            feed.scrollTop = feed.scrollHeight;

            // Keep only last 100 lines
            while (feed.children.length > 100) {
                feed.removeChild(feed.firstChild);
            }
        }

        function addToMutationHistory(mutationData) {
            mutationHistory.unshift(mutationData);
            
            // Keep only last 50 mutations
            if (mutationHistory.length > 50) {
                mutationHistory = mutationHistory.slice(0, 50);
            }
        }

        function displayMutation(mutationData) {
            const historyContainer = document.getElementById('mutation-history');
            const mutationDiv = document.createElement('div');
            mutationDiv.className = 'mutation-display';
            
            if (mutationData.suspicious) {
                mutationDiv.style.borderLeft = '4px solid var(--accent-color)';
                mutationDiv.style.background = '#fdf2f2';
            }

            const typeDiv = document.createElement('div');
            typeDiv.className = 'mutation-type';
            typeDiv.textContent = `${mutationData.type.toUpperCase()} - ${mutationData.timestamp.toLocaleTimeString()}`;
            
            const detailsDiv = document.createElement('div');
            detailsDiv.className = 'mutation-details';
            
            let details = `Target: ${mutationData.target.tagName || 'Unknown'}`;
            
            if (mutationData.type === 'childList') {
                details += `\nAdded: ${mutationData.addedNodes.length} nodes`;
                details += `\nRemoved: ${mutationData.removedNodes.length} nodes`;
            } else if (mutationData.type === 'attributes') {
                details += `\nAttribute: ${mutationData.attributeName}`;
                if (mutationData.oldValue !== null) {
                    details += `\nOld Value: ${mutationData.oldValue}`;
                }
            }

            if (mutationData.suspicious) {
                details += `\n‚ö†Ô∏è SUSPICIOUS: ${mutationData.suspicionReasons.join(', ')}`;
            }

            detailsDiv.textContent = details;
            
            mutationDiv.appendChild(typeDiv);
            mutationDiv.appendChild(detailsDiv);
            
            historyContainer.insertBefore(mutationDiv, historyContainer.firstChild);

            // Keep only last 20 displayed mutations
            while (historyContainer.children.length > 20) {
                historyContainer.removeChild(historyContainer.lastChild);
            }
        }

        function addSuspiciousActivity(mutationData) {
            const container = document.getElementById('suspicious-activity');
            
            // Remove "no activity" message if present
            const noActivity = container.querySelector('.detection-result.safe');
            if (noActivity) {
                container.removeChild(noActivity);
            }

            const activityDiv = document.createElement('div');
            activityDiv.className = 'detection-result detected';
            
            activityDiv.innerHTML = `
                <div class="result-timestamp">${mutationData.timestamp.toLocaleString()}</div>
                <div class="result-message">Suspicious DOM mutation detected</div>
                <div class="result-details">
                    Type: ${mutationData.type}<br>
                    Target: ${mutationData.target.tagName || 'Unknown'}<br>
                    Reasons: ${mutationData.suspicionReasons.join(', ')}
                </div>
            `;

            container.insertBefore(activityDiv, container.firstChild);

            // Keep only last 10 suspicious activities
            while (container.children.length > 10) {
                container.removeChild(container.lastChild);
            }
        }

        function shouldDisplayMutation(mutationData) {
            // Check filters
            const filterChildList = document.getElementById('filter-childList').checked;
            const filterAttributes = document.getElementById('filter-attributes').checked;
            const filterCharacterData = document.getElementById('filter-characterData').checked;

            if (mutationData.type === 'childList' && !filterChildList) return false;
            if (mutationData.type === 'attributes' && !filterAttributes) return false;
            if (mutationData.type === 'characterData' && !filterCharacterData) return false;

            return true;
        }

        function updateStats() {
            document.getElementById('total-mutations').textContent = mutationCount;
            document.getElementById('suspicious-mutations').textContent = suspiciousCount;
            document.getElementById('elements-added').textContent = elementsAdded;
            document.getElementById('elements-removed').textContent = elementsRemoved;
            document.getElementById('attribute-changes').textContent = attributeChanges;
        }

        function updateMonitorStatus() {
            const statusElement = document.getElementById('monitor-status');
            if (domMonitorActive) {
                statusElement.textContent = 'Active';
                statusElement.className = 'status safe';
            } else {
                statusElement.textContent = 'Inactive';
                statusElement.className = 'status';
            }
        }

        function clearMutations() {
            mutationCount = 0;
            suspiciousCount = 0;
            elementsAdded = 0;
            elementsRemoved = 0;
            attributeChanges = 0;
            mutationHistory = [];

            document.getElementById('mutation-history').innerHTML = `
                <div class="mutation-display">
                    <div class="mutation-type">History Cleared</div>
                    <div class="mutation-details">Mutation history has been cleared</div>
                </div>
            `;

            document.getElementById('suspicious-activity').innerHTML = `
                <div class="detection-result safe">
                    <div class="result-message">No suspicious activity detected</div>
                    <div class="result-details">System monitoring for AI agent patterns</div>
                </div>
            `;

            updateStats();
            logToFeed('Mutation history cleared', 'info');
        }

        function takeDOMSnapshot() {
            const snapshot = {
                timestamp: new Date().toISOString(),
                totalElements: document.querySelectorAll('*').length,
                scripts: document.scripts.length,
                stylesheets: document.styleSheets.length,
                highZIndexElements: getHighZIndexElements(),
                suspiciousElements: getSuspiciousElements()
            };

            const blob = new Blob([JSON.stringify(snapshot, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `dom-snapshot-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            logToFeed('DOM snapshot saved', 'success');
        }

        function analyzeDOMStructure() {
            const treeContainer = document.getElementById('dom-tree');
            treeContainer.innerHTML = '';

            const analyzeElement = (element, level = 0) => {
                const div = document.createElement('div');
                div.className = 'tree-node';
                div.style.marginLeft = `${level * 20}px`;

                const tagName = element.tagName || element.nodeName;
                const id = element.id ? `#${element.id}` : '';
                const className = element.className ? `.${element.className.split(' ').join('.')}` : '';
                
                div.textContent = `${tagName}${id}${className}`;

                // Check if element is suspicious
                if (isSuspiciousElement(element)) {
                    div.classList.add('suspicious');
                    div.title = 'Potentially suspicious element';
                }

                treeContainer.appendChild(div);

                // Analyze children (limit depth to prevent performance issues)
                if (level < 3 && element.children) {
                    Array.from(element.children).slice(0, 10).forEach(child => {
                        analyzeElement(child, level + 1);
                    });
                }
            };

            analyzeElement(document.documentElement);
            logToFeed('DOM structure analyzed', 'info');
        }

        function isSuspiciousElement(element) {
            if (element.nodeType !== Node.ELEMENT_NODE) return false;

            const suspiciousPatterns = [
                'pplx-agent-overlay',
                'comet-agent',
                'ai-assistant',
                'bot-overlay',
                'automation-overlay'
            ];

            const id = element.id || '';
            const className = element.className || '';
            
            // Check for suspicious patterns
            for (const pattern of suspiciousPatterns) {
                if (id.includes(pattern) || className.includes(pattern)) {
                    return true;
                }
            }

            // Check for high z-index
            const style = window.getComputedStyle(element);
            const zIndex = parseInt(style.zIndex) || 0;
            if (zIndex > 9999) return true;

            return false;
        }

        function getHighZIndexElements() {
            return Array.from(document.querySelectorAll('*'))
                .filter(el => {
                    const zIndex = parseInt(window.getComputedStyle(el).zIndex) || 0;
                    return zIndex > 1000;
                })
                .map(el => ({
                    tag: el.tagName,
                    id: el.id,
                    class: el.className,
                    zIndex: window.getComputedStyle(el).zIndex
                }));
        }

        function getSuspiciousElements() {
            return Array.from(document.querySelectorAll('*'))
                .filter(el => isSuspiciousElement(el))
                .map(el => ({
                    tag: el.tagName,
                    id: el.id,
                    class: el.className
                }));
        }

        function logToFeed(message, level = 'info') {
            const feed = document.getElementById('mutation-feed');
            const timestamp = new Date().toLocaleTimeString();
            const line = document.createElement('div');
            line.className = `feed-line highlight-${level === 'success' ? 'green' : level === 'warning' ? 'yellow' : level === 'error' ? 'red' : 'blue'}`;
            line.textContent = `[${timestamp}] ${message}`;
            feed.appendChild(line);
            feed.scrollTop = feed.scrollHeight;
        }

        // Test functions
        function testAddElement() {
            const testElement = document.createElement('div');
            testElement.id = 'test-element-' + Date.now();
            testElement.className = 'test-element';
            testElement.style.cssText = 'position: absolute; top: -9999px; z-index: 1;';
            testElement.textContent = 'Test element for DOM monitoring';
            document.body.appendChild(testElement);
            
            setTimeout(() => {
                if (testElement.parentNode) {
                    document.body.removeChild(testElement);
                }
            }, 2000);
            
            logToFeed('Test: Element added and will be removed in 2s', 'info');
        }

        function testModifyStyle() {
            const testElement = document.createElement('div');
            testElement.id = 'test-style-' + Date.now();
            document.body.appendChild(testElement);
            
            setTimeout(() => {
                testElement.style.cssText = 'position: fixed; z-index: 99999; background: red; opacity: 0.5;';
                setTimeout(() => {
                    if (testElement.parentNode) {
                        document.body.removeChild(testElement);
                    }
                }, 2000);
            }, 500);
            
            logToFeed('Test: Style modification in 0.5s', 'info');
        }

        function testInjectOverlay() {
            const overlay = document.createElement('div');
            overlay.id = 'test-overlay-' + Date.now();
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(255, 0, 0, 0.1);
                z-index: 99999;
                pointer-events: none;
            `;
            document.body.appendChild(overlay);
            
            setTimeout(() => {
                if (overlay.parentNode) {
                    document.body.removeChild(overlay);
                }
            }, 3000);
            
            logToFeed('Test: Overlay injected, will be removed in 3s', 'warning');
        }

        function testAgentPattern() {
            const agentElement = document.createElement('div');
            agentElement.id = 'pplx-agent-overlay-stop-button';
            agentElement.className = 'comet-agent-overlay';
            agentElement.textContent = 'Stop AI Assistant';
            agentElement.style.cssText = 'position: absolute; top: -9999px;';
            document.body.appendChild(agentElement);
            
            setTimeout(() => {
                if (agentElement.parentNode) {
                    document.body.removeChild(agentElement);
                }
            }, 2000);
            
            logToFeed('Test: AI agent pattern injected', 'warning');
        }

        function testExtensionInject() {
            const extensionElement = document.createElement('div');
            extensionElement.id = 'extension-content-' + Date.now();
            extensionElement.setAttribute('data-extension', 'test-extension');
            extensionElement.style.cssText = 'position: absolute; top: -9999px;';
            document.body.appendChild(extensionElement);
            
            setTimeout(() => {
                if (extensionElement.parentNode) {
                    document.body.removeChild(extensionElement);
                }
            }, 2000);
            
            logToFeed('Test: Extension injection pattern', 'info');
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeDOMMonitor);
    </script>
</body>
</html>
